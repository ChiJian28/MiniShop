# 🔍 登录功能调试步骤

## 问题描述
使用 `admin/password` 登录后，没有自动跳转到秒杀页面。

## 调试步骤

### 1. 打开浏览器开发者工具
- 在 Chrome/Safari 中按 `F12` 或 `Cmd+Option+I`
- 切换到 **Console** 标签页

### 2. 访问登录页面
- 打开 http://localhost:3000/login
- 查看 Console 中是否有错误信息

### 3. 尝试登录
- 输入用户名: `admin`
- 输入密码: `password`
- 点击"登录"按钮
- **观察 Console 输出**，应该看到类似以下信息：

```
Attempting login with: {username: "admin", password: "password"}
Mock login attempt: {username: "admin", password: "password"}
Login successful: {code: 0, data: {…}, message: "登录成功"}
Login response: {code: 0, data: {…}, message: "登录成功"}
AuthContext login called: {newToken: "mock_jwt_token_1234567890", newUser: {…}}
AuthContext: token stored in localStorage
AuthContext: user stored in localStorage
AuthContext: state updated {isAuthenticated: true, token: "mock_jwt_token_1234567890", user: {…}}
Auth context updated with token: mock_jwt_token_1234567890
Auth context updated with user: {id: 1, username: "admin"}
Navigating to /seckill...
ProtectedRoute: {requireAuth: true, isAuthenticated: true, loading: false, pathname: "/seckill"}
ProtectedRoute: rendering children
```

### 4. 检查可能的问题

#### 问题1: Console 有错误信息
- 如果看到红色错误，复制错误信息
- 常见错误：
  - `Cannot find module 'react-router-dom'` - 需要安装依赖
  - `useAuth must be used within an AuthProvider` - 组件层级问题

#### 问题2: 登录成功但没有跳转
- 检查是否看到 `Navigating to /seckill...` 日志
- 检查是否看到 `ProtectedRoute: rendering children` 日志
- 如果没有，可能是路由配置问题

#### 问题3: AuthContext 状态没有更新
- 检查是否看到 `AuthContext login called` 日志
- 检查是否看到 `AuthContext: state updated` 日志
- 如果没有，可能是 Context 没有正确连接

### 5. 手动测试存储
在 Console 中运行：
```javascript
// 检查 localStorage
console.log('Token:', localStorage.getItem('token'));
console.log('User:', localStorage.getItem('user'));

// 手动清除存储（如果需要重新测试）
localStorage.removeItem('token');
localStorage.removeItem('user');
```

### 6. 测试路由导航
在 Console 中运行：
```javascript
// 手动导航到秒杀页面
window.location.href = '/seckill';
```

### 7. 使用调试工具
- 打开 `debug-login.html` 文件
- 使用调试工具测试登录流程
- 对比调试工具和实际应用的行为差异

## 常见解决方案

### 解决方案1: 重启开发服务器
```bash
cd frontend
# 停止服务器 (Ctrl+C)
npm start
```

### 解决方案2: 清除浏览器缓存
- 打开开发者工具
- 右键点击刷新按钮
- 选择"清空缓存并硬性重新加载"

### 解决方案3: 检查依赖
```bash
cd frontend
npm list react-router-dom
# 如果没有安装，运行：
npm install react-router-dom@^6.20.0
```

### 解决方案4: 手动测试各个步骤
1. 先测试登录 API 是否正常
2. 再测试 AuthContext 是否正常
3. 最后测试路由导航是否正常

## 预期结果
登录成功后应该：
1. ✅ Console 显示登录成功日志
2. ✅ localStorage 存储 token 和用户信息
3. ✅ AuthContext 状态更新为已登录
4. ✅ 自动跳转到 `/seckill` 页面
5. ✅ Header 显示用户名和"退出"按钮

如果以上任何一步失败，请查看对应的 Console 错误信息并按照解决方案处理。 